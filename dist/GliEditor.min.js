/*! glieditor v1.5.1 2016-02-29 */
!function(a){a.fn.extend({draggable:function(b){return b=a.extend({floow:!0},b),a(this).each(function(){function c(c){"touchstart"==c.type&&(c.pageX=c.originalEvent.touches[0].pageX,c.pageY=c.originalEvent.touches[0].pageY),h=i=c,f={},f.elem=g,f.travelled=0,a(document).bind("mouseup touchend",d),a(document).bind("mousemove touchmove",e),b.onStart&&b.onStart(f)}function d(c){h=i=void 0,a(document).unbind("mouseup touchend",d),a(document).unbind("mousemove touchmove",e),b.onEnd&&b.onEnd(f)}function e(c){h&&("touchmove"==c.type&&(c.pageX=c.originalEvent.touches[0].pageX,c.pageY=c.originalEvent.touches[0].pageY),f.travelled++,f.distanceX=c.pageX-h.pageX,f.distanceY=c.pageY-h.pageY,f.distance=Math.sqrt(f.distanceX*f.distanceX+f.distanceY*f.distanceY),f.offsetX=c.pageX-i.pageX,f.offsetY=c.pageY-i.pageY,i=c,b.floow&&"absolute"==a(g).css("position")&&a(g).css({top:a(g).offset().top+f.offsetY,left:a(g).offset().left+f.offsetX}),b.onStep&&b.onStep(f))}var f,g=this;if("draggable"!=a(g).data("draggable")){a(g).data("draggable","draggable");var h,i;a(this).bind("mousedown touchstart",c)}}),this}})}($),function(a){a.fn.extend({resizable:function(b){return b=a.extend({multi:!1},b),a(this).each(function(){function c(){b.multi||a(".resizable").hide(),e.css({top:a(f).offset().top-1,left:a(f).offset().left-1,height:a(f).height(),width:a(f).width()}),e.show()}function d(b){return"none"==e.css("display")?(c(),a(document).one("click",function(){e.hide()}),!1):void 0}var e,f=this;if(f.$resizable)e=f.$resizable;else{e=a("<div class='resizable'></div>");for(var g=0;4>g;g++){var h=a("<div class='point point-"+g+"'></div>").css("position","absolute");switch(g){case 3:h.draggable({floow:!1,onStep:function(b){a(f).css({width:a(f).width()+b.offsetX,height:a(f).height()+b.offsetY}),c()}})}e.bind("click",function(){return!1}),e.append(h)}a(f).bind("click",d),e.hide(),a("body").append(e),f.$resizable=e}}),this}})}($),function(a){a.fn.extend({select:function(b){b=a.extend({items:[{name:"默认名称",value:"default_value",style:"color:red;"}]},b);var c,d=this,e=b.items,f=b.callback||{};if(d.selector)c=d.selector;else{c=a("<div class='select'></div>");for(var g=0;g<e.length;g++){var h=a("<div class='item'></div>");if(h.html(e[g].name),h.data("name",e[g].name),h.data("value",e[g].value),e[g].style)for(var i=e[g].style.split(";"),j=0;j<i.length;j++)h.css(i[j].split(":")[0],i[j].split(":")[1]);h.bind("click",function(){f.onSelect&&f.onSelect(a(this).data("value")),c.hide()}),h.bind("mouseover",function(){f.onOver&&f.onOver(a(this).data("value"))}),c.append(h)}a("body").append(c)}return c.css({top:a(this).offset().top+a(this).height(),left:a(this).offset().left}),a(document).one("click",function(){c.hide(),f.onHide&&f.onHide(a(this).data("value"))}),a(".select").hide(),c.show(),f.onShow&&f.onShow(a(this).data("value")),d.selector=c,!0}})}($),function(a){a.extend({modal:function(b){function c(a){var c={};c.type="cancle",c.body=j,b.onCancle&&b.onCancle(c),f.remove(),e(a)}function d(a){var c={};c.type="submit",c.body=j,b.onSubmit&&0!=b.onSubmit(c)&&(f.remove(),e(a))}function e(a){var c={};c.type="submit",c.boyd=j,b.onHide&&b.onHide(c)}b=a.extend({height:400,width:400,title:"标题",body:a("内容"),cancle:!0,cancleTitle:"取消",submitTitle:"确认",show:!0},b);var f=a("<div class='modal-mask'></div>"),g=a("<div class='modal'></div>");g.css({"max-height":b.height,"max-width":b.width});var h=a("<div class='modal-title'><span class='title'>"+b.title+"</span></div>");if(b.cancle){var i=a("<span class='close'>X</span>");i.bind("click",c),h.append(i)}var j=a("<div class='modal-body'></div>");j.css({"max-height":b.height-50}),j.append(b.body);var k=a("<div class='modal-footer'></div>"),l=a("<div class='modal-button modal-submit'><span>"+b.submitTitle+"</span></div>");if(l.bind("click",d),k.append(l),b.cancle){var m=a("<div class='modal-button modal-cancle'><span>"+b.cancleTitle+"</span></div>");m.bind("click",c),k.append(m)}return g.append(h),g.append(j),g.append(k),f.append(g),b.show?f.show():f.hide(),a("body").append(f),f}})}($),function(a){window.colorPicker=function(a){return new colorPicker.fn.init(a)},colorPicker.fn=colorPicker.prototype={init:function(b){function c(a){var b=a.pageY-i.find(".value").offset().top;0>b&&(b=0),b>i.find(".value").height()-10&&(b=i.find(".value").height()-10),i.find(".point").css("top",b);var c=a.pageX-i.find(".value").offset().left;0>c&&(c=0),c>i.find(".value").width()-10&&(c=i.find(".value").width()-10),i.find(".point").css("left",c),g.refresh("hsv")}function d(a){var b=a.pageY-j.find(".value").offset().top;0>b&&(b=0),b>j.find(".value").height()-1&&(b=j.find(".value").height()-1),j.find(".point").css("top",b),g.refresh("hsv")}function e(a){var b=a.pageY-k.find(".value").offset().top;0>b&&(b=0),b>k.find(".value").height()-1&&(b=k.find(".value").height()-1),k.find(".point").css("top",b),g.refresh("alpha")}var f=a.extend(colorPicker.config,b);this.config=f;var g=this,h=a(colorPicker.htmlTemplates);g.$colorPicker=h,h.bind("click",function(){return!1});var i=h.find(".sv");i.find(".value,.point").bind("mousedown",function(b){c(b),a(document).bind("mousemove",c),a(document).bind("mouseup",function(){a(document).unbind("mousemove",c)})});var j=h.find(".h");j.find(".value,.point").bind("mousedown",function(b){d(b),a(document).bind("mousemove",d),a(document).bind("mouseup",function(){a(document).unbind("mousemove",d)})});var k=h.find(".alpha");return k.find(".value,.point").bind("mousedown",function(b){e(b),a(document).bind("mousemove",e),a(document).bind("mouseup",function(){a(document).unbind("mousemove",e)})}),h.children(".value").find("input").bind("change",function(){g.refresh(this.name)}),a("body").append(h),f.show&&g.show(),g},refresh:function(a){a=a||"hsv";var b,c,d,e,f,g=this,h=(g.$colorPicker.find(".alpha").find(".point").offset().top-g.$colorPicker.find(".alpha").offset().top)/180;switch(a){case"hsv":b=2*(g.$colorPicker.find(".h").find(".point").offset().top-g.$colorPicker.find(".h").offset().top),c=(g.$colorPicker.find(".sv").find(".point").offset().left-g.$colorPicker.find(".sv").offset().left)/180,d=1-(g.$colorPicker.find(".sv").find(".point").offset().top-g.$colorPicker.find(".sv").offset().top)/180;break;case"h":b=Number.parseFloat(g.$colorPicker.children(".value").find("input[name='h']").val()),b=isNaN(b)?g.$colorPicker.children(".value").find("input[name='h']").data("value"):b,c=(g.$colorPicker.find(".sv").find(".point").offset().left-g.$colorPicker.find(".sv").offset().left)/180,d=1-(g.$colorPicker.find(".sv").find(".point").offset().top-g.$colorPicker.find(".sv").offset().top)/180;break;case"s":b=2*(g.$colorPicker.find(".h").find(".point").offset().top-g.$colorPicker.find(".h").offset().top),c=Number.parseFloat(g.$colorPicker.children(".value").find("input[name='s']").val()),c=isNaN(c)?g.$colorPicker.children(".value").find("input[name='s']").data("value"):c,d=1-(g.$colorPicker.find(".sv").find(".point").offset().top-g.$colorPicker.find(".sv").offset().top)/180;break;case"v":b=2*(g.$colorPicker.find(".h").find(".point").offset().top-g.$colorPicker.find(".h").offset().top),c=(g.$colorPicker.find(".sv").find(".point").offset().left-g.$colorPicker.find(".sv").offset().left)/180,d=Number.parseFloat(g.$colorPicker.children(".value").find("input[name='v']").val()),d=isNaN(d)?g.$colorPicker.children(".value").find("input[name='v']").data("value"):d;break;case"rgb":var i=g.$colorPicker.children(".value").find("input[name='rgb']").val().match(/[0-9]+/g)||[];e={r:Number.parseInt(i[0]),g:Number.parseInt(i[1]),b:Number.parseInt(i[2])},(e.r>255||e.r<0||e.g>255||e.g<0||e.b>255||e.b<0)&&(e=g.$colorPicker.children(".value").find("input[name='rgb']").data("value"));var j=colorPicker.rgb2hsv(e);b=j.h,c=j.s,d=j.v;break;case"hex":var e=colorPicker.hex2rgb(g.$colorPicker.children(".value").find("input[name='hex']").data("value")),j=colorPicker.rgb2hsv(e);b=j.h,c=j.s,d=j.v;break;default:b=2*(g.$colorPicker.find(".h").find(".point").offset().top-g.$colorPicker.find(".h").offset().top),c=(g.$colorPicker.find(".sv").find(".point").offset().left-g.$colorPicker.find(".sv").offset().left)/180,d=1-(g.$colorPicker.find(".sv").find(".point").offset().top-g.$colorPicker.find(".sv").offset().top)/180}b=b>=358?360:b,c=c>=.94?1:c,d=d>=.94?1:d,h=h>=.99?1:h,b=0>b?0:b,c=0>c?0:c,d=0>d?0:d,e=e?e:colorPicker.hsv2rgb({h:b,s:c,v:d}),f=f?f:colorPicker.rgb2hex(e),g.$colorPicker.find(".h").find(".point").css("top",(360==b?358:b)/2),g.$colorPicker.find(".sv").css("background-color","rgb("+colorPicker.hsv2rgb({h:b,s:1,v:1}).rgb+")"),g.$colorPicker.find(".sv").find(".point").css({top:180*(1-d>=.94?.94:1-d),left:180*(1==c?.94:c)}),g.$colorPicker.children(".value").find("input[name='h']").val(Math.floor(b)).data("value",b),g.$colorPicker.children(".value").find("input[name='s']").val(c.toFixed(2)).data("value",c),g.$colorPicker.children(".value").find("input[name='v']").val(d.toFixed(2)).data("value",d),h>=0&&1>h?g.$colorPicker.children(".value").find("input[name='rgb']").val("rgba("+e.r+","+e.g+","+e.b+","+h.toFixed(1)+")").data("value",e):g.$colorPicker.children(".value").find("input[name='rgb']").val("rgb("+e.r+","+e.g+","+e.b+")").data("value",e),g.$colorPicker.children(".value").find("input[name='hex']").val("#"+f).data("value",f),g.config.onChange&&g.config.onChange({rgb:g.$colorPicker.children(".value").find("input[name='rgb']").val(),hex:g.$colorPicker.children(".value").find("input[name='hex']").val()})},show:function(){a(".colorpicker").hide(300),this.config.dom&&this.$colorPicker.css({top:a(this.config.dom).offset().top+a(this.config.dom).height()+10,left:a(this.config.dom).offset().left}),this.$colorPicker.show(300)},hide:function(){this.$colorPicker.hide(300)}},colorPicker.fn.init.prototype=colorPicker.fn,colorPicker.htmlTemplates="<div class='colorpicker'><div class='sv'><div class='value'></div><div class='point'></div></div><div class='h'><div class='value'></div><div class='point'></div></div><div class='alpha'><div class='value'></div><div class='point'></div></div><div class='value'><label>RGB:</label><input name='rgb'></input><br /><label>HEX:</label><input name='hex'></input><br /><label>H:</label><input name='h' ></input><br /><label>S:</label><input name='s' ></input><br /><label>V:</label><input name='v' '></input></div><div style='clear: both;'></div></div>",colorPicker.config={history:"false",show:!1},colorPicker.rgb2hsv=function(a){var b,c,d,e=a.r/255,f=a.g/255,g=a.b/255;return max=Math.max(e,f,g),min=Math.min(e,f,g),d=max,c=0!=d?1-min/max:0,max==min&&(b=0),max==f&&(b=60*((g-e)/(max-min))+120),max==g&&(b=60*((e-f)/(max-min))+240),max==e&&(b=f>=g?60*((f-g)/(max-min))+0:60*((f-g)/(max-min))+360),{h:b,s:c,v:d}},colorPicker.hsv2rgb=function(a){var b=a.h,c=a.s,d=a.v;b=b>=360?0:b;var e=Math.floor(Math.abs(b/60))%6,f=b/60-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j={r:Math.floor(255*[d,h,g,g,i,d][e]),g:Math.floor(255*[i,d,d,h,g,g][e]),b:Math.floor(255*[g,g,i,d,d,h][e])};return j.rgb=j.r+","+j.g+","+j.b,j},colorPicker.rgb2hex=function(a){return((a.r<16?"0":"")+a.r.toString(16)+(a.g<16?"0":"")+a.g.toString(16)+(a.b<16?"0":"")+a.b.toString(16)).toUpperCase()},colorPicker.hex2rgb=function(a){return a=a.split(""),{r:parseInt(a[0]+a[a[3]?1:0],16)/255,g:parseInt(a[a[3]?2:1]+(a[3]||a[1]),16)/255,b:parseInt((a[4]||a[2])+(a[5]||a[2]),16)/255}},a.fn.extend({colorPicker:function(b){return a(this).each(function(c){if(0==c){var d,e=this;e.colorPicker?d=e.colorPicker:(b.dom=e,d=new colorPicker(b),a(e).bind("click",function(){return d.show(),!1}),a(document).bind("click",function(){d.hide()}),e.colorPicker=d)}}),this}})}($),function(a){window.GliEditor=function(a){return a.parent.editor?a.parent.editor:new GliEditor.fn.init(a)},GliEditor.fn=GliEditor.prototype={init:function(b){var c=a.extend(GliEditor.config,b);this.config=c,this.Event=GliEditor.Event;var d=this;d.$container=a(GliEditor.htmlTemplates.container).css({"max-width":c.width}),d.$parent=a(c.parent),d.$menu=a(GliEditor.htmlTemplates.menu);for(var e=0;e<c.menu.length;e++){for(var f=a(GliEditor.htmlTemplates.menuGroup),g=0;g<c.menu[e].length;g++){var h=GliEditor.menu[c.menu[e][g]];if(h){var i=a(GliEditor.htmlTemplates.menuItem);i.attr("title",h.title);for(var j=0;j<h.icon.length;j++)$icon=a(GliEditor.htmlTemplates.menuItemIcon),$icon.addClass(h.icon[j]),i.append($icon);i.bind("click",{menuName:c.menu[e][g],editor:d},d.execMenu),f.append(i)}}d.$menu.append(f)}d.$menu.append(a(GliEditor.htmlTemplates.clear)),d.$editor=a(GliEditor.htmlTemplates.editor),d.$editor.css({height:c.height});for(var e=0;e<c.pages.length;e++)d.addPage(c.pages[e]);return d.$editor.bind("mousedown",function(b){a.contains(this,a(b.srcElement).closest(".ge-editor-page")[0])&&(d.START_RANGE_RECORD=!0)}),a(document).bind("mouseup",function(a){d.START_RANGE_RECORD&&(d.START_RANGE_RECORD=!1,d.saveRange())}),d.addEventListener("onPageChange",function(b){var c=a(b.page);GliEditor.verifiPage(c)||c.html(c.data("beforeHtml"))}),d.$container.append(d.$menu),d.$container.append(d.$editor),d.$parent.append(d.$container),d.$menu.bind("mousedown mouseup",function(){return!1}),d.$parent[0].editor=d,d},html:function(a){var b=this;if(void 0==a)return b.getPage(b.$editor.find(".ge-editor-page"));b.$editor.html("");for(var c=0;c<a.length;c++)b.addPage(a[c])},remove:function(){var a=this;a.$parent[0].editor=void 0,a.$container.remove()},appendChild:function(b){var c,d=this,e=d.currentRange();return c=a(e.startContainer===e.endContainer?e.startContainer:e.commonAncestorContainer),c.after(b),!0},addPage:function(b,c){var d=this,e=a(GliEditor.htmlTemplates.editorPage);if(e.data("type",b.type),e.data("id",b.id),e.html(b.html),e.addClass(b.type),e.data("ext",b.ext),e.data("beforeHtml",e.html()),e.find("img").resizable(),0==d.config.multi&&d.$editor.find(".ge-editor-page").length>=1)return!1;for(var f=0;f<d.config.support.length&&d.config.support[f]!=b.type;f++)if(d.config.support[f]!=b.type&&f==d.config.support.length-1)return!1;return GliEditor.verifiPage(e)?(e.bind("keydown",function(b){var c=d.currentRange();if(8==b.which&&0==c.startOffset&&0==c.endOffset){var e=d.getPage(a(this));return"text"==e[0].type&&1==d.$editor.find(".ge-editor-page.text").length?!1:(a(this).remove(),d.doEventListener("onPageDelete",{page:e}),!1)}return 13==b.which&&0==b.shiftKey?(d.addPage({type:"text",html:""},this),!1):void 0}),e.bind("keyup mouseup",function(b){a(this).html()!=a(this).data("beforeHtml")&&d.doEventListener("onPageChange")}),c?a(c).after(e):this.$editor.append(e),d.doEventListener("onPageCreate"),!0):!1},getPage:function(b){var c=[];return b&&b.each(function(b){var d={id:a(this).data("id"),type:a(this).data("type"),index:b,ext:a(this).data("ext"),html:this.innerHTML};switch(a(this).data("type")){case"text":d.content=d.html.replace(/<[^>].*?>/g,"");break;case"img":d.content=d.ext?d.ext.img_url:d.html}c.push(d)}),c},replacePage:function(b,c){var d=this,e=d.getPage(c)[0];e=a.extend(!0,e,b),d.config.multi?(d.addPage(e,c),c.remove()):(c.remove(),d.addPage(e))},addEventListener:function(a,b){var c=this;c.Event[a]&&c.Event[a].push(b)},doEventListener:function(b,c){var d=this;c=a.extend({editor:d,type:b},c);var e=d.currentRange();if(e&&!c.page){var f=a(e.commonAncestorContainer).closest(".ge-editor-page");c.page=d.getPage(f)}if(d.Event[b])for(var g=d.Event[b],h=0;h<g.length;h++)g[h](c)},execMenu:function(a){var b=a.data,c=GliEditor.menu[b.menuName];return a.data.that=this,a.data.menuItem=c,!b.editor.restoreRange()&&c.needRange?(alert("需要选中区域"),!1):(c.callback&&c.callback(a),!1)},currentRange:function(a){return void 0==a?this.currentRangeData:void(this.currentRangeData=a)},saveRange:function(){var b,c,d;document.getSelection?(b=document.getSelection(),b.getRangeAt&&b.rangeCount&&(c=document.getSelection().getRangeAt(0),d=c.commonAncestorContainer)):(c=document.selection.createRange(),d=c.parentElement()),this.$editor[0]==a(d).closest(".ge-editor")[0]?this.currentRange(c):this.currentRange(null)},restoreRange:function(){var a=this.currentRange();if(!a)return!1;if(document.getSelection)selection=document.getSelection(),selection.removeAllRanges(),selection.addRange(a);else{var b=document.selection.createRange();b.setEndPoint("EndToEnd",a),0===a.text.length?b.collapse(!1):b.setEndPoint("StartToStart",a),b.select()}return!0}},GliEditor.Event={onPageCreate:[],onPageChange:[],onPageDelete:[]},GliEditor.fn.init.prototype=GliEditor.fn,a.fn.extend({GliEditor:function(b){var c=[];return this.each(function(){c.push(new GliEditor(a.extend(b,{parent:this})))}),1==c.length?c[0]:c}})}($),GliEditor.menu={viewSourceCode:{title:"源代码",icon:["fa fa-code"],callback:function(a){a.data.editor}},bold:{title:"粗体",needRange:!0,icon:["fa fa-bold"],callback:function(a){var b=a.data.editor;document.execCommand("bold",!1),b.saveRange()}},underline:{title:"下划线",needRange:!0,icon:["fa fa-underline"],callback:function(a){var b=a.data.editor;document.execCommand("underline",!1),b.saveRange()}},italic:{title:"斜体",icon:["fa fa-italic"],callback:function(a){var b=a.data.editor;document.execCommand("italic",!1),b.saveRange()}},strikethrough:{title:"删除线",needRange:!0,icon:["fa fa-strikethrough"],callback:function(a){var b=a.data.editor;document.execCommand("strikethrough",!1),b.saveRange()}},forecolor:{title:"字体颜色",needRange:!0,icon:["fa fa-circle-o","fa fa-angle-down"],callback:function(a){for(var b=a.data.editor,c={items:[],callback:{onShow:function(a){},onSelect:function(a){b.restoreRange(),document.execCommand("foreColor",!1,a),b.saveRange()},onHide:function(a){b.restoreRange()}}},d=["#595757","#FFFFFF","#FF1600","#C9CACA","#1024EE"],e=0;e<d.length;e++)c.items.push({name:d[e],value:d[e],style:"color:"+d[e]+";"});$(a.data.that).select(c)}},backcolor:{title:"背景颜色",needRange:!0,icon:["fa fa-circle","fa fa-angle-down"],callback:function(a){for(var b=a.data.editor,c={items:[],callback:{onShow:function(a){},onSelect:function(a){b.restoreRange(),document.execCommand("backColor",!1,a),b.saveRange()},onHide:function(a){b.restoreRange()}}},d=["#595757","#FFFFFF","#C3FFF0","#FEE2F4","#1024EE"],e=0;e<d.length;e++)c.items.push({name:d[e],value:d[e],style:"background-color:"+d[e]+";"});$(a.data.that).select(c)}},fontSize:{title:"字号",needRange:!0,icon:["fa fa-header","fa fa-angle-down"],callback:function(a){for(var b=a.data.editor,c={items:[],callback:{onShow:function(a){},onSelect:function(a){b.restoreRange(),document.execCommand("fontSize",!1,a),b.saveRange()},onHide:function(a){b.restoreRange()}}},d=[1,2,3,4,5,6],e=0;e<d.length;e++)c.items.push({name:"H"+(e+1),value:d[e]});$(a.data.that).select(c)}},fontFamily:{title:"字体",needRange:!0,icon:["fa fa-font","fa fa-angle-down"],callback:function(a){for(var b=a.data.editor,c={items:[],callback:{onShow:function(a){},onSelect:function(a){b.restoreRange(),document.execCommand("FontName",!1,a),b.saveRange()},onHide:function(a){b.restoreRange()}}},d=["宋体","黑体","微软雅黑","cursive"],e=0;e<d.length;e++)c.items.push({name:d[e],value:d[e]});$(a.data.that).select(c)}},justify:{title:"对齐方式",needRange:!0,icon:["fa fa-align-left","fa fa-angle-down"],callback:function(a){for(var b=a.data.editor,c={items:[],callback:{onShow:function(a){},onSelect:function(a){b.restoreRange(),document.execCommand(a),b.saveRange()},onHide:function(a){b.restoreRange()}}},d=["左对齐","居中","右对齐"],e=["JustifyLeft","JustifyCenter","JustifyRight"],f=0;f<d.length;f++)c.items.push({name:d[f],value:e[f]});$(a.data.that).select(c)}},insertImage:{title:"插入图片",icon:["fa fa-image"],callback:function(a){var b=a.data.editor,c=$(GliEditor.htmlTemplates.insertImage);$.uploadfile({action:b.config.upload,selectBtn:c.find("input[name='selector']"),callback:function(a){c.find("input[name='src']").val(a.src).show(),c.find("input[name='selector']").hide(),c.find("input[name='title']").val(a.title),c.find("input[name='height']").val(a.height),c.find("input[name='width']").val(a.width),c.data("ext",a)}}),$.modal({width:310,title:a.data.menuItem.title,body:c,onSubmit:function(a){var d=c.find("input[name='src']").val(),e=c.find("input[name='height']").val(),f=c.find("input[name='width']").val(),g=c.find("input[name='title']").val(),h=b.currentRange(),i=h?$(h.commonAncestorContainer).closest(".ge-editor-page"):void 0,j=b.getPage(i);j.length&&"img"==j[0].type&&confirm("确认替换?")?b.replacePage({type:"img",html:"<img src='"+d+"' height='"+e+"' width='"+f+"' tiltle='"+g+"'/>",ext:c.data("ext")},i):b.addPage({type:"img",html:"<img src='"+d+"' height='"+e+"' width='"+f+"' tiltle='"+g+"'/>",ext:c.data("ext")},i)},onHide:function(){b.restoreRange()}})}},insertFormula:{title:"公式",icon:["fa fa-cogs"],callback:function(a){var b,c=a.data.editor,d=c.currentRange(),e=$(d?d.commonAncestorContainer:"");b=e.hasClass("formula")||0!=e.find(".formula").length?e.hasClass("formula")?e:e.find(".formula"):$("<img class='formula'/>");var f=b.attr("data-formula")||"",g=c.config.formula_iframe+"?formula="+f,h=c.config.formula_img+f,i=$(GliEditor.htmlTemplates.insertFormula);i.find(".iframe").attr("src",g),i.find(".formula-preview").attr("src",h),window.FORMULA_CALLBACK=function(a){console.log(a),i.find(".formula-preview").attr({src:c.config.formula_img+encodeURI(a),"data-formula":encodeURI(a)})},$.modal({width:800,title:"公式编辑",body:i,onSubmit:function(a){var d=decodeURI(i.find(".formula-preview").attr("data-formula"));b.attr({src:c.config.formula_img+encodeURI(d),"data-formula":encodeURI(d)}),0===b.parent().length&&c.appendChild(b)},onHide:function(){c.restoreRange()}})}},insertVariant:{title:"插入异体字",icon:["fa fa-gg"],callback:function(a){var b=a.data.editor,c=b.currentRange(),d=c?c.toString():"";return 1!=d.length?(alert("请选中一个字!"),!1):void $.ajax({type:"get",url:b.config.variant,data:{variant:encodeURIComponent(d)},dataType:"JSONP",success:function(c){if(c&&0!=c.length){for(var e=$(GliEditor.htmlTemplates.insertVariant),f=0;f<c.length;f++){var g=$("<font face='"+c[f]+"'>"+d+"</font>");g.bind("click",function(){$this=$(this),$this.closest(".ge-insertVariant").find("font").removeClass("selected"),$this.addClass("selected")}),e.append(g)}$.modal({width:310,title:a.data.menuItem.title,body:e,onSubmit:function(a){var c=a.body,d=c.find("font.selected");b.restoreRange(),document.execCommand("FontName",!1,d.attr("face")),b.saveRange()},onHide:function(){b.restoreRange()}})}else alert("未找到异体字!")},async:!0})}},"delete":{title:"删除",needRange:!0,icon:["fa fa-close"],callback:function(a){var b=a.data.editor,c=b.currentRange(),d=c?$(c.commonAncestorContainer).closest(".ge-editor-page"):void 0;return d.hasClass("text")&&1==b.$editor.find(".ge-editor-page.text").length?!1:void(confirm("是否删除此页?")&&$(d).remove())}},moveup:{title:"上移",needRange:!0,icon:["fa fa-arrow-up"],callback:function(a){var b=a.data.editor,c=b.currentRange(),d=c?$(c.commonAncestorContainer).closest(".ge-editor-page"):void 0,e=d.prev();e.insertAfter(d)}},movedown:{title:"下移",needRange:!0,icon:["fa fa-arrow-down"],callback:function(a){var b=a.data.editor,c=b.currentRange(),d=c?$(c.commonAncestorContainer).closest(".ge-editor-page"):void 0,e=d.next();e.insertBefore(d)}}},GliEditor.htmlTemplates={container:"<div class='ge-container'></div>",menu:"<div class='ge-menu'></div>",menuGroup:"<div class='ge-menu-group'></div>",menuItem:"<div class='ge-menu-item'></div>",menuItemIcon:"<span></span>",editor:"<div class='ge-editor'></div>",editorPage:"<div class='ge-editor-page' contenteditable='true'></div>",clear:'<div style="clear:both"></div>',insertImage:"<div class='ge-insertImage'><div class='line'><span>图片：</span><input type='text'  name='src' placeholder='http://baidu.com/loge.png'/><input name='selector' type='button' value='选择文件' /></div><div class='line'><span>标题：</span><input  name='title'/></div><div class='line'><span>高度：</span><input  name='height' style='width: 70px;'/></div><div class='line'><span>宽度：</span><input  name='width' style='width: 70px;'/></div></div>",insertFormula:"<div class='insertFormula'><iframe class='iframe'></iframe><img class='formula-preview' /></div>",insertVariant:"<div class='ge-insertVariant'></div>"},GliEditor.config={upload:"/ajax/ajax_edit_content2.php?act=pic_upload",variant:"http://wk1.ak.kf.gli.cn/ajax/ajax_edit_content2.php?act=variant",formula_iframe:"../dist/eq_editor/index.html",formula_img:"http://192.168.1.7/cgi-bin/tex.exe?",menu:[["bold","underline","italic","foreColor","backgroundColor","strikethrough","forecolor","backcolor"],["fontFamily","fontSize","justify"],["insertImage","insertFormula","insertVideo","insertVariant","insertCode"],["delete","moveup","movedown"]],width:"80",height:"400",fullScreen:!1,pages:[],support:["text","img","audio","video"],multi:!0},$.extend(GliEditor,{createRange:function(a,b,c){a=$(".ge-editor-page")[0];var d=document.createRange();return d.selectNode(a),document.getSelection().removeAllRanges(),document.getSelection().addRange(d),d},verifiPage:function(a){switch(a.data("type")){case"text":if(0!=a.find("img").length||0!=a.find("audio").length||0!=a.find("video").length)return!1;break;case"img":if(a.find("img").length>1)return!1;var b=$(a[0].outerHTML);if(b.find("img").remove(),""!=b.html())return!1;break;case"audio":if(1!=a.find("audio").length)return!1;var b=$(a[0].outerHTML);if(b.find("audio").remove(),""!=b.html())return!1;break;case"video":if(1!=a.find("video").length)return!1;var b=$(a[0].outerHTML);if(b.find("video").remove(),""!=b.html())return!1;break;default:return!1}return!0}}),function(a){a.extend({uploadfile:function(b){function c(){var c=a("<iframe style='display:none;'></iframe>"),d=a("<form>");d.attr({action:b.action,method:"post",enctype:"multipart/form-data"});var e;e=a(b.autoUpload?"<input type='file'  id ='files' name='"+(b.filname||"upfile")+"' onchange='submit.click();'/>":"<input type='file'  id ='files' name='"+(b.filname||"upfile")+"'/>"),d.append(e);var f=a("<input  id ='submit' type='submit'/>");d.append(f);var g="uploadCallback"+(new Date).getTime()+Math.floor(1e6*Math.random());window[g]=b.callback;var h=a("<input type='hidden' id ='callback' name='callback' value='"+g+"'/>");d.append(h);var i=a("<input type='hidden' id = 'domain' name='domain' value='"+window.location.host+"'/>");d.append(i);var j=d[0].outerHTML;return j=j.replace(/\"/g,'\\"'),j=j.replace(/\'/g,"\\'"),j=j.replace(/\>/g,"\\>"),j=j.replace(/\</g,"\\<"),c.attr("src",'javascript:void(function(str){document.open();document.write(str);document.close();})("'+j+'")'),a("body").append(c),c}b=a.extend({autoUpload:!0},b);var d,e=b;return e.select=function(){d&&0!=d.length&&d.remove(),d=c();var a=d[0].contentWindow.document,b=a.getElementById("files");b.click()},e.submit=function(){if(!d||0==d.length)return alert("系统错误,请重试或联系管理员"),!1;var a=d[0].contentWindow.document;if(""==a.getElementById("files").value)return alert("请选择文件"),!1;var b=a.getElementById("submit");b.click(),d.remove()},b.selectBtn&&b.selectBtn.bind("click",function(){e.select()}),b.submitBtn&&b.submitBtn.bind("click",function(){e.submit()}),e}})}($);